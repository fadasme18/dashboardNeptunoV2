<div class="dashboard-header">
  <div class="connection-status">
    Estado Conexión:
    <span [ngClass]="{
      'status-connecting': wsConnectionStatus === 'connecting',
      'status-connected': wsConnectionStatus === 'connected',
      'status-error': wsConnectionStatus === 'error' || wsConnectionStatus === 'closed'
    }">
      {{ wsConnectionStatus | uppercase }}
    </span>
  </div>
  <div *ngIf="lastUpdateTime" class="last-update-time">
    Última actualización: {{ lastUpdateTime | date:'mediumTime' }}
  </div>
</div>

<div class="section-container">
  <h2 class="section-title">FUNDICIÓN 1</h2>
  <div class="horno-vista-container">
    <div class="estado-maquina-wrapper">
      <div
        *ngFor="let maquina of maquinasFundicion1"
        class="estado-maquina"
        [ngClass]="{
          online: maquina.estado === true,
          offline: maquina.estado === false,
          esperando: maquina.estado === null
        }"
      >
        <span class="nombre-maquina">{{ maquina.nombreMostrado }}</span>
        <span class="tag-estado">
          {{
            maquina.estado === true
              ? "ONLINE"
              : maquina.estado === false
              ? "OFFLINE"
              : "ESPERANDO..."
          }}
        </span>
        </div>
    </div>
  </div>
</div>
<div class="section-container">
  <h2 class="section-title">FUNDICIÓN 2</h2>
  <div class="horno-vista-container">
    <div class="estado-maquina-wrapper">
      <div
        *ngFor="let maquina of maquinasFundicion2"
        class="estado-maquina"
        [ngClass]="{
          online: maquina.estado === true,
          offline: maquina.estado === false,
          esperando: maquina.estado === null
        }"
      >
        <span class="nombre-maquina">{{ maquina.nombreMostrado }}</span>
        <span class="tag-estado">
          {{
            maquina.estado === true
              ? "ONLINE"
              : maquina.estado === false
              ? "OFFLINE"
              : "ESPERANDO..."
          }}
        </span>
      </div>
    </div>
  </div>

  <div *ngIf="hornoPrincipalKPIs" class="section-container kpi-section">
  <h2 class="section-title">Indicadores Clave - Horno Inducción Principal</h2>

  <div *ngIf="hornoPrincipalKPIs.contextoCalculoGeneral as contexto" class="kpi-context">
    <p>
      <strong>Datos del Día:</strong> {{ contexto.fechaReporte }}
      (hasta {{ contexto.horaReporte }}).
    </p>
    <p>
      <strong>Periodo Laboral Analizado Hoy:</strong>
      {{ contexto.periodoAnalizadoDiaActual.inicio }} -
      {{ contexto.periodoAnalizadoDiaActual.fin }}
    </p>
  </div>

  <div class="kpi-grid">
    <div *ngIf="hornoPrincipalKPIs.produccion as produccion" class="kpi-card produccion-kpi">
      <h3 class="kpi-title">Producción del Día</h3>
      <div class="kpi-value-main">{{ produccion.cantidadColadasDiaActual }}</div>
      <div class="kpi-unit">Colada(s)</div>
      <small *ngIf="produccion.nota" class="kpi-note">{{ produccion.nota }}</small>
    </div>

    <div *ngIf="hornoPrincipalKPIs.tiempoDeUso as uso" class="kpi-card tiempo-kpi">
      <h3 class="kpi-title">Tiempo de Uso</h3>
      <div class="kpi-value-main">{{ uso.horas.toFixed(1) }} <span class="kpi-sub-unit">hrs</span></div>
      <div class="kpi-detail">({{ uso.minutos }} min)</div>
      <div class="kpi-value-percentage">{{ uso.porcentaje.toFixed(1) }}%</div>
      <div class="kpi-unit-small">del periodo laboral analizado</div>
    </div>

    <div *ngIf="hornoPrincipalKPIs.tiempoDeNoUso as noUso" class="kpi-card tiempo-kpi">
      <h3 class="kpi-title">Tiempo de No Uso</h3>
      <div class="kpi-value-main">{{ noUso.horas.toFixed(1) }} <span class="kpi-sub-unit">hrs</span></div>
      <div class="kpi-detail">({{ noUso.minutos }} min)</div>
      <div class="kpi-value-percentage">{{ noUso.porcentaje.toFixed(1) }}%</div>
      <div class="kpi-unit-small">del periodo laboral analizado</div>
    </div>

    <div *ngIf="hornoPrincipalKPIs.consumoEnergetico as consumo" class="kpi-card consumo-kpi">
      <h3 class="kpi-title">Consumo Energético</h3>
      <div class="kpi-value-main">
        {{ consumo.consumoTotalEstimadoKWh.toFixed(2) }}
        <span class="kpi-sub-unit">kWh</span>
      </div>
      <div class="kpi-detail-consumo">
        <span>Inicial:
          {{ consumo.valorInicialAcumuladorKWh !== null ? consumo.valorInicialAcumuladorKWh.toFixed(2) : 'N/A' }}
          kWh
          <small *ngIf="consumo.timestampValorInicialUTC">({{ consumo.timestampValorInicialUTC | date:'HH:mm' }}
            UTC)</small>
        </span>
        <span>Final:
          {{ consumo.valorFinalAcumuladorKWh !== null ? consumo.valorFinalAcumuladorKWh.toFixed(2) : 'N/A' }}
          kWh
          <small *ngIf="consumo.timestampValorFinalUTC">({{ consumo.timestampValorFinalUTC | date:'HH:mm' }}
            UTC)</small>
        </span>
      </div>
      <small *ngIf="consumo.notaImportante" class="kpi-note">{{ consumo.notaImportante }}</small>
    </div>
  </div>
</div>
</div>





<!-- ---------------------FUNDICION 1--------------------- -->
<!-- <div class="horno-vista-container">
  <div class="estado-maquina-wrapper">
    <div
      class="estado-maquina"
      [ngClass]="{
        online: estado_horno1F1 === true,
        offline: estado_horno1F1 === false
      }"
    >
      <span class="nombre-maquina">Horno 1</span>
      <span class="tag-estado">
        {{
          estado_horno1F1 === true
            ? "ONLINE"
            : estado_horno1F1 === false
            ? "OFFLINE"
            : "ESPERANDO..."
        }}
      </span>
    </div>

    <div
      class="estado-maquina"
      [ngClass]="{
        online: estado_horno2F1 === true,
        offline: estado_horno2F1 === false
      }"
    >
      <span class="nombre-maquina">Horno 2</span>
      <span class="tag-estado">
        {{
          estado_horno2F1 === true
            ? "ONLINE"
            : estado_horno2F1 === false
            ? "OFFLINE"
            : "ESPERANDO..."
        }}
      </span>
    </div>

    <div
      class="estado-maquina"
      [ngClass]="{
        online: estado_horno3F1 === true,
        offline: estado_horno3F1 === false
      }"
    >
      <span class="nombre-maquina">Horno 3</span>
      <span class="tag-estado">
        {{
          estado_horno3F1 === true
            ? "ONLINE"
            : estado_horno3F1 === false
            ? "OFFLINE"
            : "ESPERANDO..."
        }}
      </span>
    </div>

    <div
      class="estado-maquina"
      [ngClass]="{
        online: estado_horno4F1 === true,
        offline: estado_horno4F1 === false
      }"
    >
      <span class="nombre-maquina">Horno 4</span>
      <span class="tag-estado">
        {{
          estado_horno4F1 === true
            ? "ONLINE"
            : estado_horno4F1 === false
            ? "OFFLINE"
            : "ESPERANDO..."
        }}
      </span>
    </div>
  </div>
</div> -->
<!-- --------------------------------------------------------------- -->

<!-- ---------------------FUNDICION 2--------------------- -->

<!-- <div class="horno-vista-container">
  <div class="estado-maquina-wrapper">
    <div
      class="estado-maquina"
      [ngClass]="{
        online: estado_horno1F2 === true,
        offline: estado_horno1F2 === false
      }"
    >
      <span class="nombre-maquina">Horno Ind 1</span>
      <span class="tag-estado">
        {{
          estado_horno1F2 === true
            ? "ONLINE"
            : estado_horno1F2 === false
            ? "OFFLINE"
            : "ESPERANDO..."
        }}
      </span>
    </div>

    <div
      class="estado-maquina"
      [ngClass]="{
        online: estado_horno2F2 === true,
        offline: estado_horno2F2 === false
      }"
    >
      <span class="nombre-maquina">Horno Ind 2</span>
      <span class="tag-estado">
        {{
          estado_horno2F2 === true
            ? "ONLINE"
            : estado_horno2F2 === false
            ? "OFFLINE"
            : "ESPERANDO..."
        }}
      </span>
    </div>

    <div
      class="estado-maquina"
      [ngClass]="{
        online: estado_silo_cohete === true,
        offline: estado_silo_cohete === false
      }"
    >
      <span class="nombre-maquina">Silo Cohete</span>
      <span class="tag-estado">
        {{
          estado_silo_cohete === true
            ? "ONLINE"
            : estado_silo_cohete === false
            ? "OFFLINE"
            : "ESPERANDO..."
        }}
      </span>
    </div>

    <div
      class="estado-maquina"
      [ngClass]="{
        online: estado_silo_norte === true,
        offline: estado_silo_norte === false
      }"
    >
      <span class="nombre-maquina">Silo Norte (Arena Reutilizada)</span>
      <span class="tag-estado">
        {{
          estado_silo_norte === true
            ? "ONLINE"
            : estado_silo_norte === false
            ? "OFFLINE"
            : "ESPERANDO..."
        }}
      </span>
    </div>

    <div
      class="estado-maquina"
      [ngClass]="{
        online: estado_silo_sur === true,
        offline: estado_silo_sur === false
      }"
    >
      <span class="nombre-maquina">Silo Sur (Arena Nueva)</span>
      <span class="tag-estado">
        {{
          estado_silo_sur === true
            ? "ONLINE"
            : estado_silo_sur === false
            ? "OFFLINE"
            : "ESPERANDO..."
        }}
      </span>
    </div>

    <div
      class="estado-maquina"
      [ngClass]="{
        online: estado_hornoTT1F2 === true,
        offline: estado_hornoTT1F2 === false
      }"
    >
      <span class="nombre-maquina">Horno TT 1</span>
      <span class="tag-estado">
        {{
          estado_hornoTT1F2 === true
            ? "ONLINE"
            : estado_hornoTT1F2 === false
            ? "OFFLINE"
            : "ESPERANDO..."
        }}
      </span>
    </div>

    <div
      class="estado-maquina"
      [ngClass]="{
        online: estado_hornoTT2F2 === true,
        offline: estado_hornoTT2F2 === false
      }"
    >
      <span class="nombre-maquina">Horno TT 2</span>
      <span class="tag-estado">
        {{
          estado_hornoTT2F2 === true
            ? "ONLINE"
            : estado_hornoTT2F2 === false
            ? "OFFLINE"
            : "ESPERANDO..."
        }}
      </span>
    </div>
  </div>
</div> -->
